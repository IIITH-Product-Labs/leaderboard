<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="{{url_for('static',filename='edit.css')}}">
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,500,600" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <div class="overlap1-l">
            <img class="iiit-new1-1-l" src="{{url_for('static',filename='iiit-new1 1.png')}}" />
            <div class="m1">
                <img class="logouticon" id="imagebutton" src="{{url_for('static',filename='logout icon.png')}}" />
                <div class="m2" id="imagecontent">
                    <a href="{{ url_for('signin') }}" class="dropdown-c1"><span>Sign In</span></a>
                    <a href="{{ url_for('signout') }}" class="dropdown-c1"><span>Sign Out</span></a>
                </div>
            </div>
        </div>
        <div class="scrollmenu-l">
    
            <a href="{{ url_for('adminabout') }}" class="nav-content">Home</a>
            <a href="{{ url_for('adminobjective') }}" class="nav-content">Objectives</a>
            <a href="{{ url_for('adminconsortium') }}" class="nav-content">Consortium Members</a>
            <a href="{{ url_for('admindocuments') }}" class="nav-content">Documents</a>

            <a target="_self" href="https://himgangycanvas.iiithcanvas.com/" class="nav-content">Applications</a>
            <div class="menu">
                <button class="dropdown-btn1" id="dropdownButton">Leader Board</button>
                <div class="menu-c" id="dropdownMenu">
                    <a href="{{ url_for('download') }}" class="dropdown-content"><span>Download test set</span></a>
                    <a href="{{ url_for('submit') }}" class="dropdown-content"><span>Submit result</span></a>
                    <a href="{{ url_for('register') }}" class="dropdown-content"><span>User registeration</span></a>
                </div>
            </div>
            <div class="menu">
                <button class="dropdown-btn2" id="dropdownButton1">For admin</button>
                <div class="menu-c" id="dropdownMenu1">
                    <a href="{{ url_for('approval') }}" class="dropdown-content"><span>Approval</span></a>
                    <a href="{{ url_for('upload') }}" class="dropdown-content"><span>Upload test set</span></a>
                    <a href="{{ url_for('edit') }}" class="dropdown-content"><span>Edit Leader board</span></a>
                </div>
            </div>
        </div>
        <div class="main">
            <div class="g73"><img src="{{url_for('static',filename='ls1.png')}}" width="55px" height="160px"></div>
            <div class="grp1"><img src="{{url_for('static',filename='lpc1.png')}}" width="80px" height="100px" ></div>
            <div class="container1">
                <div class="row">
                    <a href="{{ url_for('adminabout') }}" class="term1">About us /</a>
                    <a href="{{ url_for('leaderboard') }}" class="term1">&nbsp;Leaderboard /</a>
                    <a href="{{ url_for('edit') }}" class="term2">&nbsp;Edit Leader board</a>
                </div>
    
                <fieldset class="fieldset">
                    <legend class="border-text">Select-Task-Type</legend>
                        <div class="dropdown">
                            <select class="select-element" onchange="getSelectedOption()">
                                <option value="Translation" selected>Translation</option>
                            </select>
                        </div>
                </fieldset>
    
            </div>
            <div class="container2 ">
                <table id="table" style="width: 91%; margin-left: -9.3%;margin-top: 3.0%;position:absolute">
                    <tr style="height:45px">
                        <th style="width:2%" class="table-heading"></th>
                        <th style="width:1%" class="table-heading"></th>
                        <th  style="width:15%" class="table-heading ">Organization</th>
                        <th style="width:15%" class="table-heading ">Language</th>
                        <th style="width:11%" class="table-heading ">Module</th>
                        <th style="width:10%" class="table-heading ">Version</th>
                        <th  style="text-align: center" colspan="3"  class="table-heading ">Metrics&Score</th>
                    </tr>
                    <tr style=" height:30px;background: #ECECEC; border: 1px solid #ADADAD; line-height: 10px; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);">
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td style="text-align: center;width:11.0%" class="table-data">bleu</td>
                        <td style="text-align: center;width:7%" class="table-data">chrf</td>
                        <td style="text-align: center;width:9%" class="table-data">ter</td>
                    </tr>
                    
                    {% for i in items %}
                        <tr class="border-bottom">
                            <form action="/update" method="POST" id="myForm" enctype="multipart/form-data">
                                <td><input type="checkbox" class="checkbox" name="checkboxes" value="{{i['rowno']}},{{i['organisation']}},{{i['language']}},{{i['module']}},{{i['version']}},{{i['bleu']}},{{i['chrf']}},{{i['ter']}}"></td>
                                <td ><input type="text" name="rowno" class="rowno" size="3" value="{{i['rowno']}}" placeholder="{{i['rowno']}}"/></td>
                                <td class="tabledata1" ><input type="text" name="organisation" class="organisation" size="19" value="{{i['organisation']}}" placeholder="{{i['organisation']}}"></td>
                                <td class="tabledata1" ><input type="text" name="language" class="organisation" size="18" value="{{i['language']}}" placeholder="{{i['language']}}"></td>
                                <td class="tabledata1"><input type="text" name="module" class="organisation" size="14" value="{{i['module']}}" placeholder="{{i['module']}}"></td>
                                <td class="tabledata1" ><input type="text" name="version" class="organisation" size="9" value="{{i['version']}}" placeholder="{{i['version']}}"></td>
                                <td  class="tabledata2" ><input type="text" name="bleu" class="bleu" size="10" value="{{i['bleu']}}" placeholder="{{i['bleu']}}"></td>
                                <td  class="tabledata2" ><input type="text" name="chrf" class="chrf"size="10" value="{{i['chrf']}}" placeholder="{{i['chrf']}}"></td>
                                <td  class="tabledata2" ><input type="text" name="ter" class="gleu" size="10" value="{{i['ter']}}" placeholder="{{i['ter']}}"></td>
                                
                            </form>
                        </tr>
                    
                    {% endfor %}
            
                </table>
                <div class="buttons">
                    <button class="deletebutton" type="submit" value="Submit" id="delete-button" >Delete</button>
                    <button class="updatebutton" type="submit" value="Submit" id="updateButton" >Update</button>
                </div>
               
            </div>
            

        </div>
      
        <script>
            
            document.addEventListener("DOMContentLoaded", function() {
                // Get the table rows
            const tableRows = document.querySelectorAll("tr.border-bottom");

            // Get the update button
            const updateButton = document.querySelector("#updateButton");

            // Add click event listener to the update button
            updateButton.addEventListener("click", function() {
            // Create an empty array to store the data of all the rows
            let allRowsData = [];

            // Loop through each row
            for (let i = 0; i < tableRows.length; i++) {
                // Get the current row
                let row = tableRows[i];

                // Get the data from the inputs of the current row
                let rowno = row.querySelector("input[name='rowno']").value;
                let organization = row.querySelector("input[name='organisation']").value;
                let language = row.querySelector("input[name='language']").value;
                let module = row.querySelector("input[name='module']").value;
                let version = row.querySelector("input[name='version']").value;
                let bleu = row.querySelector("input[name='bleu']").value;
                let chrf = row.querySelector("input[name='chrf']").value;
                let ter = row.querySelector("input[name='ter']").value;

                // Store the data in the array
                allRowsData.push({
                rowno: rowno,
                organization: organization,
                language: language,
                module: module,
                version: version,
                bleu: bleu,
                chrf: chrf,
                ter: ter
                });
            }

            // Do something with the data of all the rows
            console.log(allRowsData);
            fetch("/update", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({rows: allRowsData})
  })
    .then(response => response.json())
    .then(data => {
      console.log(data);
      if (data.message === "Data updated successfully") {
        window.location.reload();
      }
    });
})
                

                const deleteButton = document.getElementById("delete-button");
                console.log(deleteButton);
                const checkboxes = document.querySelectorAll('input[type="checkbox"]');
                console.log(checkboxes.length);


                deleteButton.addEventListener('click', () => {
                    const selectedCheckboxes = Array.from(checkboxes).filter(checkbox => checkbox.checked);
                    const selectedRowNumbers = selectedCheckboxes.map(checkbox => checkbox.value);
                    console.log(selectedCheckboxes)
                    console.log(selectedRowNumbers)

                    // Send selected row numbers to the backend using an XHR request
                    const xhr = new XMLHttpRequest();
                    xhr.open('POST', '/delete-checkboxes', true);
                    xhr.setRequestHeader('Content-Type', 'application/json');
                    xhr.send(JSON.stringify({
                        rowNumbers: selectedRowNumbers
                    }));

                    xhr.onreadystatechange = function() {
                        if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                            // Refresh the page
                            location.reload();
                        }
                    };
                });
               
            function getSelectedOption() {
                var selectedOption = document.querySelector('select').value;
                console.log(selectedOption)
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "/route/to/flask/endpoint", true);
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.send(JSON.stringify({ option: selectedOption }));
                console.log("send");
                xhr.addEventListener('load', function() {
                    const response = JSON.parse(xhr.response);
                    console.log(response)
                    
                });
            }
            var imagebutton = document.getElementById('imagebutton');
            var imagecontent = document.getElementById('imagecontent');
            imagebutton.addEventListener('click', function() {
                imagebutton.classList.toggle('open');
            });
    
            
            var dropdownButton = document.getElementById('dropdownButton');
            var dropdownMenu = document.getElementById('dropdownMenu');

            dropdownButton.addEventListener('click', function() {
                dropdownButton.classList.toggle('open');
            });
            

            var dropdownButton1 = document.getElementById('dropdownButton1');
            var dropdownMenu1 = document.getElementById('dropdownMenu1');

            dropdownButton1.addEventListener('click', function() {
                dropdownButton1.classList.toggle('open');
            });
            
});

        </script>
    </body>
</html>

